<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOUSE AI | ULTIMATE HYBRID SYSTEM</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00d2ff;
            --accent: #00ff88;
            --bg-dark: #02040a;
            --panel-bg: #0d1117;
            --text: #e6edf3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background: var(--bg-dark); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Header */
        nav {
            height: 70px; background: #000; border-bottom: 2px solid var(--primary);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; box-shadow: 0 0 20px rgba(0, 210, 255, 0.2); z-index: 10;
        }
        .brand { font-family: 'Orbitron'; font-size: 1.8rem; color: var(--primary); letter-spacing: 2px; }
        .clock { font-family: 'Orbitron'; color: var(--accent); font-size: 1.1rem; }

        .main-wrapper { display: flex; flex: 1; width: 100%; overflow: hidden; }

        /* Sidebar المطور */
        .sidebar { width: 420px; background: var(--panel-bg); border-left: 1px solid #30363d; display: flex; flex-direction: column; }

        .control-tabs { padding: 20px; background: #161b22; border-bottom: 1px solid #333; }
        .input-box { width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 8px; margin-bottom: 10px; outline: none; transition: 0.3s; }
        .input-box:focus { border-color: var(--primary); }

        .btn-action {
            width: 100%; padding: 12px; background: var(--primary); border: none; border-radius: 8px;
            font-weight: bold; cursor: pointer; color: #000; transition: 0.3s; margin-bottom: 10px;
        }
        .btn-action:hover { background: var(--accent); box-shadow: 0 0 15px var(--accent); }

        .divider { text-align: center; margin: 10px 0; font-size: 0.8rem; color: #555; position: relative; }
        .divider::before { content: ""; position: absolute; left: 0; top: 50%; width: 40%; height: 1px; background: #333; }
        .divider::after { content: ""; position: absolute; right: 0; top: 50%; width: 40%; height: 1px; background: #333; }

        .search-container { padding: 15px; border-bottom: 1px solid #333; }
        .channel-grid { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }

        .channel-item {
            display: flex; align-items: center; padding: 12px; background: #161b22; border-radius: 10px;
            cursor: pointer; border: 1px solid transparent; transition: 0.2s;
        }
        .channel-item:hover { border-color: var(--primary); background: #1c2128; transform: translateX(-5px); }
        .channel-item img { width: 45px; height: 45px; border-radius: 5px; margin-left: 15px; object-fit: contain; background: #000; }
        .channel-item .info b { font-size: 0.95rem; color: #fff; }
        .channel-item .info p { font-size: 0.75rem; color: var(--primary); }

        /* Main Player Area */
        .content-area { flex: 1; padding: 25px; background: #05070a; display: flex; flex-direction: column; }
        .video-container { flex: 1; background: #000; border-radius: 20px; overflow: hidden; border: 1px solid #30363d; position: relative; }
        video { width: 100%; height: 100%; }

        .playing-info {
            margin-top: 15px; padding: 20px; background: var(--panel-bg); border-radius: 15px;
            display: flex; justify-content: space-between; align-items: center; border: 1px solid #222;
        }

        /* Footer */
        footer {
            height: 45px; background: #000; border-top: 1px solid #333;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.85rem; color: #8b949e;
        }
        footer b { color: var(--primary); margin: 0 5px; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>
<body>

<nav>
    <div class="brand">MOUSE AI <span style="font-size: 0.7rem; opacity: 0.6;">HYBRID V4</span></div>
    <div class="clock" id="liveClock">00:00:00</div>
</nav>

<div class="main-wrapper">
    <aside class="sidebar">
        <div class="control-tabs">
            <p style="font-size: 0.8rem; margin-bottom: 10px; color: var(--primary);"><i class="fas fa-link"></i> إضافة عن طريق رابط M3U:</p>
            <input type="text" id="m3uUrlInput" class="input-box" placeholder="ضع الرابط هنا...">
            <button class="btn-action" onclick="fetchFromUrl()">جلب وحفظ الرابط</button>

            <div class="divider">أو</div>

            <p style="font-size: 0.8rem; margin-bottom: 10px; color: var(--accent);"><i class="fas fa-file-upload"></i> إضافة ملف من الجهاز:</p>
            <input type="file" id="m3uFileInput" accept=".m3u,.txt">
            <button class="btn-action" style="background: var(--accent);" onclick="handleFileUpload()">تحميل ملف القنوات</button>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" class="input-box" placeholder="ابحث عن اسم القناة..." onkeyup="filterChannels()">
            <select id="groupFilter" class="input-box" onchange="filterChannels()">
                <option value="all">جميع التصنيفات</option>
            </select>
        </div>

        <div class="channel-grid" id="channelList">
            </div>
        
        <button onclick="clearSystem()" style="background: transparent; border: none; color: #444; padding: 10px; cursor: pointer; font-size: 0.7rem;">إعادة ضبط النظام (حذف الكل)</button>
    </aside>

    <main class="content-area">
        <div class="video-container">
            <video id="mainPlayer" controls autoplay poster="https://wallpaperaccess.com/full/1567831.jpg"></video>
        </div>

        <div class="playing-info">
            <div>
                <h2 id="nowPlayingName" style="color: var(--primary);">جاهز للبث...</h2>
                <p id="nowPlayingGroup" style="color: var(--accent); font-size: 0.9rem;">بانتظار اختيار القناة</p>
            </div>
            <div style="text-align: left;">
                <span id="channelCount" style="color: #8b949e; font-size: 0.8rem;">0 قناة متوفرة</span>
            </div>
        </div>
    </main>
</div>

<footer>
    تم التطوير بواسطة <b>Mustafa (MisterAI)</b> | جميع الحقوق محفوظة &copy; 2025
</footer>

<script>
    let globalChannels = [];
    const video = document.getElementById('mainPlayer');
    const hls = new Hls();

    // الساعة
    setInterval(() => { document.getElementById('liveClock').textContent = new Date().toLocaleTimeString('en-GB'); }, 1000);

    // تحميل البيانات المحفوظة عند الفتح
    window.onload = () => {
        const saved = localStorage.getItem('MisterAI_Storage_V4');
        if (saved) {
            globalChannels = JSON.parse(saved);
            updateUI();
        }
    };

    // 1. الجلب من رابط
    async function fetchFromUrl() {
        const url = document.getElementById('m3uUrlInput').value;
        if (!url) return alert("يرجى وضع الرابط أولاً يا مصطفى!");
        
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error();
            const text = await response.text();
            parseAndSave(text);
            document.getElementById('m3uUrlInput').value = '';
        } catch (err) {
            alert("حدث خطأ في جلب الرابط. تأكد من صحة الرابط أو جرب ميزة الملف.");
        }
    }

    // 2. الجلب من ملف
    function handleFileUpload() {
        const file = document.getElementById('m3uFileInput').files[0];
        if (!file) return alert("يرجى اختيار ملف أولاً!");

        const reader = new FileReader();
        reader.onload = (e) => {
            parseAndSave(e.target.result);
            document.getElementById('m3uFileInput').value = '';
        };
        reader.readAsText(file);
    }

    // تحليل وحفظ مشترك
    function parseAndSave(data) {
        const lines = data.split('\n');
        const parsedChannels = [];
        
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF:')) {
                const name = lines[i].split(',')[1]?.trim() || "قناة غير مسماة";
                const group = lines[i].match(/group-title="([^"]+)"/)?.[1] || "غير مصنف";
                const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const url = lines[i+1]?.trim();

                if (url && url.startsWith('http')) {
                    parsedChannels.push({ name, group, logo, url });
                }
            }
        }

        globalChannels = parsedChannels;
        localStorage.setItem('MisterAI_Storage_V4', JSON.stringify(globalChannels));
        updateUI();
        alert(`تم حفظ ${parsedChannels.length} قناة بنجاح!`);
    }

    function updateUI() {
        updateGroupDropdown();
        renderChannels(globalChannels);
        document.getElementById('channelCount').textContent = `${globalChannels.length} قناة متوفرة`;
    }

    function updateGroupDropdown() {
        const select = document.getElementById('groupFilter');
        const groups = [...new Set(globalChannels.map(c => c.group))];
        select.innerHTML = '<option value="all">جميع التصنيفات</option>';
        groups.forEach(g => {
            select.innerHTML += `<option value="${g}">${g}</option>`;
        });
    }

    function renderChannels(data) {
        const list = document.getElementById('channelList');
        list.innerHTML = '';
        data.forEach(c => {
            const div = document.createElement('div');
            div.className = 'channel-item';
            div.innerHTML = `
                <img src="${c.logo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                <div class="info">
                    <b>${c.name}</b>
                    <p>${c.group}</p>
                </div>
            `;
            div.onclick = () => playStream(c);
            list.appendChild(div);
        });
    }

    function filterChannels() {
        const search = document.getElementById('searchInput').value.toLowerCase();
        const group = document.getElementById('groupFilter').value;
        const filtered = globalChannels.filter(c => 
            (group === 'all' || c.group === group) && c.name.toLowerCase().includes(search)
        );
        renderChannels(filtered);
    }

    function playStream(c) {
        document.getElementById('nowPlayingName').textContent = c.name;
        document.getElementById('nowPlayingGroup').textContent = c.group;
        if (Hls.isSupported()) {
            hls.destroy();
            const newHls = new Hls();
            newHls.loadSource(c.url);
            newHls.attachMedia(video);
            newHls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = c.url;
            video.play();
        }
    }

    function clearSystem() {
        if(confirm("هل تريد حذف كل القنوات المحفوظة؟")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>
</body>
</html>

